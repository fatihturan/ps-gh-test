{% extends "blog/base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}
{% load my_tags %}

<head>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" as="style">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet" media="screen" onload="this.media='all'">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" as="style">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet" media="screen" onload="this.media='all'">

    <script src="https://kit.fontawesome.com/70572890b0.js" crossorigin="anonymous"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MVXEN40PGH"></script>

    <!-- Froala JS & CSS -->
    <script src="https://cdn.jsdelivr.net/npm/froala-editor@3.2.2/js/froala_editor.pkgd.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/froala-editor@3.2.2/css/froala_editor.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/froala-editor@3.2.2/css/froala_editor.pkgd.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/froala-editor@3.2.2/css/froala_style.min.css">
    <link rel="stylesheet" href="../css/third_party/embedly.min.css">

    <link rel="preload" href="{% static 'app-assets/css/colors.min.css' %}" as="style">
    <link rel="stylesheet" type="text/css" href="{% static 'app-assets/css/colors.min.css' %}" media="print" onload="this.media='all'">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-185900750-1">
    </script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-185900750-1');
    </script>
</head>


<style>

    .form-control{
        font-family: 'Roboto', sans-serif;
        font-size: 32px;
        font-weight:400;
        background-color: #fff !important;
    }

    .fr-element{
        font-family: 'Roboto', sans-serif;
        font-weight:300;
        font-size:17px!important;
    }

    form .form-control{
        border-width: 0px;
        border-right: 0px;
        border-left: 0px;
        border-top: 0px;
        border-radius: 0px;
    }

    form label{
        visibility: hidden; display: none;
        color: white;
    }

    .div_id_title{
                background: #fff;
    }

    .btn-outline-primary:hover{
        color:#4EC48F!important
    }

    .form-check-label{
        visibility: hidden; display: none;
        margin-left:25px;
        color: white!important;
    }

    #id_related_sport{
        font-size: 15px;
        width:150px;
        border: 1px solid #CCCCCC;
        border-radius: 10px 10px 10px;
        label: "Select a sport:";
    }

    @media screen and (min-width: 767px) {

        .form-control{
            font-family: 'Roboto', serif;
            font-size: 45px;
            font-weight:400;
            background-color: #fff !important;
        }

        .fr-element{
            font-family: 'Roboto', sans-serif;
            font-weight:300;
            font-size:19px!important;
        }
    }

    @media screen and (max-width: 767px) {
        .fr-command.fr-btn+.fr-dropdown-menu .fr-dropdown-wrapper .fr-dropdown-content ul.fr-dropdown-list li {
            font-size: 9px!important
        }
    }

</style>

<div style="margin-top:10px"></div>

{% include "blog/chat_bot.html" %}
{% include "blog/article_bot.html" %}

<div class="all-content">

    <div class="new-post user-post">
        <form method="POST">
            {% csrf_token %}
            <fieldset>
                {{ form.media }}
                {{ form | crispy }}
            </fieldset>
            <div class="hidden-md-up">
                <button class="btn darkmode-flip" id="draft_btn" onclick="document.getElementById('id_draft').checked = true" style="color: white!important; background-color: #274970!important; border-radius:14px;" type="submit" name="save_draft">Save</button>
                <button class="btn darkmode-flip" onclick="document.getElementById('id_draft').checked = false" style="color: white!important; background-color: #274970!important; border-radius:14px;" type="submit" style="top:50%; left:50%;">Publish</button>
            </div>
            <div class="hidden-sm-down">
                <button class="btn btn-outline-primary darkmode-flip" id="draft_btn" onclick="document.getElementById('id_draft').checked = true" style="background-color: #274970!important; border-radius:18px;" type="submit" name="save_draft">Save</button>
                <button class="btn btn-outline-primary darkmode-flip" onclick="document.getElementById('id_draft').checked = false" style="background-color: #274970!important; border-radius:18px" type="submit">Publish</button>
            </div>
            <small style="display:inline-block;margin-top:10px;margin-bottom:5px">*Click "Save" to make edits later and "Publish" to post to Pine.</small>
        </form>
    </div>

</div>

<script>
//Froala Embedly Script
(function(e){"function"===typeof define&&define.amd?define(["jquery"],e):"object"===typeof module&&module.exports?module.exports=function(h,a){void 0===a&&(a="undefined"!==typeof window?require("jquery"):require("jquery")(h));e(a);return a}:e(jQuery)})(function(e){var h=/^(http|https):\/\/(([a-zA-Z0-9$\-_.+!*'(),;:&=]|%[0-9a-fA-F]{2})+@)?(((25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])(\.(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])){3})|localhost|([a-zA-Z0-9\-\u00C0-\u017F]+\.)+([a-zA-Z]{2,}))(:[0-9]+)?(\/(([a-zA-Z0-9$\-_.+!*'(),;:@&=]|%[0-9a-fA-F]{2})*(\/([a-zA-Z0-9$\-_.+!*'(),;:@&=]|%[0-9a-fA-F]{2})*)*)?(\?([a-zA-Z0-9$\-_.+!*'(),;:@&=\/?]|%[0-9a-fA-F]{2})*)?(\#([a-zA-Z0-9$\-_.+!*'(),;:@&=\/?]|%[0-9a-fA-F]{2})*)?)?$/;e.extend(e.FroalaEditor.POPUP_TEMPLATES,{"embedly.insert":"[_BUTTONS_][_INPUT_LAYER_]"});e.extend(e.FroalaEditor.DEFAULTS,{embedlyOptions:{},embedlyHelpText:"Paste a URL to generate code"});e.FroalaEditor.PLUGINS.embedly=function(a){function k(){var b=a.popups.get("embedly.insert"),d=b.find("ul.errorlist"),b=b.find('input.fr-link-attr[type="text"][name="href"]');d.hide();d.html("");b.val("").trigger("change")}function g(b){var d=a.popups.get("embedly.insert"),c=d.find("ul.errorlist"),d=d.find('input.fr-link-attr[type="text"][name="href"]');c.html("<li>"+b+"</li>").fadeIn();d.one("keyup",function(){c.fadeOut()})}function m(b){a.events.focus(!0);a.selection.restore();var d=e.trim(b);if(""===d)return g("The URL is invalid. Please enter a valid URL."),!1;d=d.replace(/ /g,"%20");/^https?:\/\//i.test(d)||(d="http://"+d);if(!h.test(d))return g("The URL is invalid. Please enter a valid URL."),!1;b=document.createElement("a");b.href=d;var c=e("#embedly-card-area");0===c.length?(c=e("<div />").appendTo("body"),c.attr("id","embedly-card-area"),c.css("display","none")):c.empty();c.append(b);var f=embedly.card(b);f?(f.on("card.snippet",function(b){b=e(b.snippet);for(var c in a.opts.embedlyOptions)a.opts.embedlyOptions.hasOwnProperty(c)&&b.attr("data-card-"+c,a.opts.embedlyOptions[c]);a.html.insert('<span contenteditable="false" class="fr-embedly embedly-card-area" data-url="'+d+'" data-title="'+b.text()+'">'+b[0].outerHTML+"</span><p><br></p>");c=a.$el.find(".fr-embedly");c.removeClass("fr-embedly");a.popups.hide("embedly.insert");a.events.trigger("embedly.inserted",[c,d,b[0].outerHTML]);return!0}),f.on("card.rendered",function(a){if("error"===a.name)return g("Cannot create a card for the url. Please check the URL you entered is correct."),!0;f.send("card.snippet")})):g("Cannot create a card for the url. Please check the URL you entered is correct.");return!1}function l(b){b&&!1!==a.events.trigger("embedly.beforeRemove",[b])&&(a.popups.hideAll(),a.toolbar.enable(),a.selection.setBefore(b.get(0))||a.selection.setAfter(b.get(0)),b.remove(),a.selection.restore(),a.html.fillEmptyBlocks(!0),a.events.trigger("embedly.removed",[b]))}return{_init:function(){a.events.on("keydown",function(b,d){var c,f=e(a.selection.element());f&&f.hasClass("embedly-card-area")&&(c=f);f=b.which;if(c&&(f==e.FroalaEditor.KEYCODE.BACKSPACE||f==e.FroalaEditor.KEYCODE.DELETE))return b.preventDefault(),l(c),!1;if(c&&!a.keys.ctrlKey(b))return b.preventDefault(),!1},!0);a.events.on("keydown",function(){a.$el.find("span.embedly-card-area:empty").remove()})},showPopup:function(){if(!a.popups.get("embedly.insert")){var b="";a.opts.popupButtons&&0<a.opts.popupButtons.length&&(b=b+'<div class="fr-buttons">'+a.button.buildList(a.opts.popupButtons),b+="</div>");var d=0,c='<div class="fr-link-insert-layer fr-layer fr-active" id="fr-link-insert-layer-'+a.id+'">',c=c+'<ul class="errorlist" style="display:none;"></ul>';a.opts.embedlyHelpText&&(c+='<span class="fr-small-text">'+a.language.translate(a.opts.embedlyHelpText)+"</span>");c+='<div class="fr-input-line"><input name="href" type="text" class="fr-link-attr" placeholder="URL" tabIndex="'+ ++d+'"></div>';c+='<div class="fr-action-buttons"><button class="fr-command fr-submit" data-cmd="linkEmbedlyInsert" href="#" tabIndex="'+ ++d+'" type="button">'+a.language.translate("Insert")+"</button></div></div>";a.popups.create("embedly.insert",{buttons:b,input_layer:c})}k();a.popups.setContainer("embedly.insert",a.$tb);b=a.$tb.find('.fr-command[data-cmd="embedlyBtn"]');d=b.offset().left+b.outerWidth()/2;c=b.offset().top+(a.opts.toolbarBottom?10:b.outerHeight()-10);a.popups.show("embedly.insert",d,c,b.outerHeight())},hidePopup:function(){a.popups.hide("embedly.insert")},insertCallback:function(){var b=a.popups.get("embedly.insert").find('input.fr-link-attr[type="text"][name="href"]').val(),d=e(a.original_window).scrollTop();m(b);e(a.original_window).scrollTop(d)},resetPopup:k,remove:l}};e.FroalaEditor.DefineIcon("embedlyBtnIcon",{NAME:"code"});e.FroalaEditor.RegisterCommand("embedlyBtn",{title:"Embed",icon:"embedlyBtnIcon",undo:!1,focus:!0,popup:!0,refreshOnCallback:!1,callback:function(){this.popups.isVisible("embedly.insert")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("embedly.insert")):this.embedly.showPopup()}});e.FroalaEditor.RegisterCommand("linkEmbedlyInsert",{focus:!1,refreshAfterCallback:!1,callback:function(){this.embedly.insertCallback()}})});
</script>

<script>

    var chart_counter = 0;

    FroalaEditor.DefineIcon('insertChart', {Name: 'Insert Chart', SRC: "{% static 'images/charts-bw.svg'%}", ALT: 'plus', template: 'image'});

    FroalaEditor.RegisterCommand('insertChart', {
        title: 'Insert Chart',
        type: 'dropdown',
        focus: false,
        undo: true,
        refreshAfterCallback: true,
        options: {
            {% for i in html_files_name %}
            '{{i}}': '{{i | upto:'.' | replace_underscore | replace_tilde}}',
            {% endfor %}
        },
        callback: function (cmd, val) {
            if (val != 'No Saved Charts'){
                if(chart_counter < 10){
                    this.html.insert(`<p></p><div class="chart-div-1"><div class="chart-div-2"></div><div class="chart-div-3"><embed src="{{CHARTS_URL}}{{user_id}}/${val}" height="100%" width="100%"></div></div><p></p>`);
                    this.undo.saveStep();
                    chart_counter = chart_counter+1;
                }
                else{
                    alert("You have reached your maximum of 10 charts per post.");
                }
            }
        },
        // Callback on refresh.
        refresh: function ($btn) {
          console.log ('do refresh');
        },
        // Callback on dropdown show.
        refreshOnShow: function ($btn, $dropdown) {
          console.log ('do refresh when show');
        }
    });


    FroalaEditor.DefineIcon('chartIcon', {Name: 'Insert Chart', SRC: "{% static 'images/charts-bw-small.svg'%}", ALT: 'plus', template: 'image'});

    FroalaEditor.RegisterQuickInsertButton('chart', {
        icon: 'chartIcon',
        title: 'Insert Chart',
        focus: true,
        undo: true,
        refreshAfterCallback: true,
        callback: function () {
            let output = prompt("Enter Chart Name:");
            if (output) {
                this.html.insert('<div class="chart-div-1"><div class="chart-div-2"></div><div class="chart-div-3">');
                this.html.insert(`<embed src="${output}" height="100%" width="100%">`);
                this.html.insert('</div></div>')
            }
        }
    });

    FroalaEditor.VIDEO_PROVIDERS = [{
        test_regex: /^.*((youtu.be)|(youtube.com))\/((v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))?\??v?=?([^#\&\?]*).*/,
        url_regex: /(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/)?([0-9a-zA-Z_\-]+)(.+)?/g,
        url_text: '//www.youtube.com/embed/$1',
        html: '<iframe width="640" height="360" src="{url}?wmode=opaque" frameborder="0" allowfullscreen></iframe>',
        provider: 'youtube'
      },
      {
        test_regex: /^.*(?:vimeo.com)\/(?:channels(\/\w+\/)?|groups\/*\/videos\/​\d+\/|video\/|)(\d+)(?:$|\/|\?)/,
        url_regex: /(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:[a-zA-Z0-9_\-]+)?/i,
        url_text: '//player.vimeo.com/video/$1',
        html: '<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',
        provider: 'vimeo'
      },
      {
        test_regex: /^.+(dailymotion.com|dai.ly)\/(video|hub)?\/?([^_]+)[^#]*(#video=([^_&]+))?/,
        url_regex: /(?:https?:\/\/)?(?:www\.)?(?:dailymotion\.com|dai\.ly)\/(?:video|hub)?\/?(.+)/g,
        url_text: '//www.dailymotion.com/embed/video/$1',
        html: '<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',
        provider: 'dailymotion'
      },
      {
        test_regex: /^.+(screen.yahoo.com)\/[^_&]+/,
        url_regex: '',
        url_text: '',
        html: '<iframe width="640" height="360" src="{url}?format=embed" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>',
        provider: 'yahoo'
      },
      {
        test_regex: /^.+(rutube.ru)\/[^_&]+/,
        url_regex: /(?:https?:\/\/)?(?:www\.)?(?:rutube\.ru)\/(?:video)?\/?(.+)/g,
        url_text: '//rutube.ru/play/embed/$1',
        html: '<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>',
        provider: 'rutube'
      },
      {
        test_regex: /^(?:.+)vidyard.com\/(?:watch)?\/?([^.&/]+)\/?(?:[^_.&]+)?/,
        url_regex: /^(?:.+)vidyard.com\/(?:watch)?\/?([^.&/]+)\/?(?:[^_.&]+)?/g,
        url_text: '//play.vidyard.com/$1',
        html: '<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',
        provider: 'vidyard'
      },
      {
        test_regex: /^(?:.+)streamable.com\/(?:watch)?\/?([^.&/]+)\/?(?:[^_.&]+)?/,
        url_regex: /^(?:.+)streamable.com\/(?:watch)?\/?([^.&/]+)\/?(?:[^_.&]+)?/g,
        url_text: '//www.streamable.com/e/$1',
        html: '<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',
        provider: 'streamable'
      },
      {
        test_regex: /^(?:.+)clippituser.tv\/(?:watch)?\/?([^.&/]+)\/?(?:[^_.&]+)?/,
        url_regex: /^(?:.+)clippituser.tv\/(?:watch)?\/?([^.&/]+)\/?(?:[^_.&]+)?/g,
        url_text: '//www.clippituser.tv/c/embed_iframe/$1',
        html: '<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',
        provider: 'streamable'
      }

    ];

</script>
<script src="https://cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
{% endblock content %}
</div>